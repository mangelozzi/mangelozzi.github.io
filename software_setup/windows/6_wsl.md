# WSL2

- Follow this guide:
- <https://docs.microsoft.com/en-us/windows/wsl/install-win10>

## DNS (Cannot resolve host)

Neovim will fail to install packages, so will apt-get update. To fix do the following:

1. Create a file: `/etc/wsl.conf`.
2. Put the following lines in the file
    ```
    [network]
    generateResolvConf = false
    ```
3. `ls -l /etc/resolv.conf`, is a symlinked file which is auto-generated.
4. Copy the contents of `/etc/resolv.conf` to say `etc/resolv.conf.bak`
5. Change `172.24.0.1` to another nameserver, e.g.:
   - Current router: `192.168.0.1`
   - Google: `8.8.8.8`
   Should be something like:
    ```
    # This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
    # [network]
    # generateResolvConf = false
    nameserver 192.168.0.1
    ```
6. Delete the symlink `rm /etc/resolve.conf`
7. In a `cmd` window, run `wsl --shutdown` or `wsl -t <DISTRIBUTION_NAME>`
8. Restart WSL2


## .BASHRC NOT EXECUTED

To tell windows to start wsl/bash with an interactive shell (i.e. load ~.bashrc)
one can do `bash.exe -i` (now you have colours and should feel more homey).

To have `wsl` or `bash` automatically start an  interactive prompt, create
`~/.profile` and paste inside of it:
```bash
if [ -n "$BASH_VERSION" ]; then
    # include .bashrc if it exists
    if [ -f "$HOME/.bashrc" ]; then
        . "$HOME/.bashrc"
    fi
fi
```

## ADD A SECOND DITRO

Based on [this SuperUser post](https://superuser.com/questions/1515246/how-to-add-second-wsl2-ubuntu-distro-fresh-install):

1. Download: <https://cloud-images.ubuntu.com/releases/focal/release/ubuntu-20.04-server-cloudimg-amd64-wsl.rootfs.tar.gz>
3. Add the new distro with:
    ```
    wsl.exe --import <DISTRO_HANDLE> <INSTALL_DIR> <DL_TAR_GZ_PATH>
    ```
    e.g. say we call this distro `ubuntu_b`:
    ```
    wsl.exe --import ubuntu_b "D:\wsl\ubuntu_b" "D:\wsl\ubuntu-20.04-server-cloudimg-amd64-wsl.rootfs.tar.gz"
    ```
4. Start the image with: `wsl.exe -d ubuntu_b`

### Change default user of NONE DEFAULT Distro

- For default distro can use `ubuntu config --default-user username`
- Refer to [github issue](https://github.com/microsoft/WSL/issues/3974).
- Add to `/etc/wsl.conf`:

### Change root password of 2nd Distribution

- When creating the 2nd distribution it does not ask you for root password.
- Open a new shell (be logged in as root).
- `passwd` and enter in the new password.

```
[user]
default=username
```

## DELETE A DISTRO

- `wsl --unregister <DISTRO_HANDLE>`
- e,g, `wsl --unregister ubuntu_b`

